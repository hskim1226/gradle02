<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.apexsoft.ysprj.user.Mapper">

    <resultMap id="user" type="com.apexsoft.ysprj.user.service.UsersVO">
        <result property="username"     column="USER_ID"/>
        <result property="userType"     column="USER_TYPE"/>
        <result property="name"         column="NAME"/>
        <result property="birth"        column="BORN_DAY"/>
        <result property="gender"       column="GEND"/>
        <result property="mobile"       column="MOBI_NUM"/>
        <result property="password"     column="PSWD"/>
        <result property="email"        column="MAIL_ADDR"/>
        <result property="smsReceive"   column="SMS_RECV_YN"/>
        <result property="emailReceive" column="MAIL_RECV_YN"/>
        <result property="divisionCode" column="USER_DIVS_CODE"/>
        <result property="termsAgree"   column="USER_AGRE_YN"/>
        <result property="privacyAgree" column="PRIV_INFO_YN"/>
        <result property="creator"      column="CRE_ID"/>
        <result property="createdDate"   column="CRE_DATE"/>
        <result property="modifier"     column="MOD_ID"/>
        <result property="modifiedDate"   column="MOD_DATE"/>
    </resultMap>

    <insert id="insertUser" parameterType="User">
        <![CDATA[
          INSERT INTO USER(USER_ID,
                             USER_TYPE,
                             NAME,
                             BORN_DAY,
                             GEND,
                             PSWD,
                             MOBI_NUM,
                             MAIL_ADDR,
                             SMS_RECV_YN,
                             MAIL_RECV_YN,
                             USER_DIVS_CODE,
                             USER_AGRE_YN,
                             PRIV_INFO_YN,
                             ENABLED,
                             CRE_ID,
                             CRE_DATE)
		             VALUES(#{username},
		                     #{userType},
                             #{name},
                             #{birth},
                             #{gender},
                             #{password},
                             #{mobile},
                             #{email},
                             #{smsReceive},
                             #{emailReceive},
                             #{divisionCode},
                             #{termsAgree},
                             #{privacyAgree},
                             #{enabled},
                             #{username},
                             now())
		]]>
    </insert>

    <update id="updateUser" parameterType="User">
        <![CDATA[
		  UPDATE USER SET
                             NAME = #{name},
                             BORN_DAY = #{birth},
                             GEND = #{gender},
                             PSWD = #{password},
                             MOBI_NUM = #{mobile},
                             MAIL_ADDR = #{email},
                             SMS_RECV_YN = #{smsReceive},
                             MAIL_RECV_YN = #{emailReceive},
                             USER_DIVS_CODE = #{divisionCode},
                             USER_AGRE_YN = #{termsAgree},
                             PRIV_INFO_YN = #{privacyAgree},
                             MOD_ID = #{modifier},
                             MOD_DATE = now()
			WHERE USER_ID = #{username}
		]]>
    </update>

    <select id="selectByPk" resultMap="user" parameterType="String">
        <![CDATA[
		  SELECT USER_ID, PSWD, NAME, MAIL_ADDR, ENABLED
		    FROM USER
			WHERE 1=1
			AND USER_ID = #{username}
		]]>
    </select>

    <select id="selectUsername" resultType="String" parameterType="User">
        <![CDATA[
          SELECT USER_ID
            FROM USER
            WHERE 1=1
            AND NAME = #{name}
            AND IFNULL(#{email}, MAIL_ADDR) = MAIL_ADDR
            AND IFNULL(#{mobile}, MOBI_NUM) = MOBI_NUM
            AND IFNULL(#{email}, #{mobile}) IS NOT NULL
        ]]>
    </select>

    <select id="selectAllByPk" resultMap="user" parameterType="String">
        <![CDATA[
          SELECT *
            FROM USER
            WHERE 1=1
            AND USER_ID = #{username}
        ]]>
    </select>

    <!-- Queries for Authority      -->

    <select id="selectAuthorities" resultType="com.apexsoft.ysprj.user.service.AuthoritiesVO"  parameterType="String">
        <![CDATA[
		  SELECT username, authority
		    FROM authorities
			WHERE 1=1
			AND username = #{username}
		]]>
    </select>

    <insert id="insertAuthority"  parameterType="com.apexsoft.ysprj.user.service.AuthoritiesVO" >
        <![CDATA[
		  INSERT INTO authorities
		                   (authority,
		                    username)
		             VALUES(#{authority},
		                    #{username})
		]]>
    </insert>

    <delete id="deleteAuthority" parameterType="com.apexsoft.ysprj.user.service.AuthoritiesVO">
        <![CDATA[
		  DELETE FROM authorities
			WHERE username = #{username}
			AND authority = #{authority}
		]]>
    </delete>
</mapper>