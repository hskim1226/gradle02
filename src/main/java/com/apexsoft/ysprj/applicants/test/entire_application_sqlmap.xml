<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.apexsoft.ysprj.test.entireApplication.Mapper">

    <resultMap id="entireApplication" type="com.apexsoft.ysprj.applicants.test.EntireApplication">
        <id property="applNo" column="appl_no"/>
        <result property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="phoneNumber" column="user_phone_number"/>
        <result property="address" column="address"/>
        <result property="deptCode" column="dept_code"/>
        <association property="department" javaType="com.apexsoft.ysprj.applicants.test.Department">
            <id property="code" column="code"/>
            <result property="name" column="dept_name"/>
            <result property="phoneNumber" column="dept_phone_number"/>
        </association>
        <collection property="academyList" ofType="com.apexsoft.ysprj.applicants.test.Academy">
            <id property="applNo" column="appl_no"/>
            <result property="seqNo" column="school_seq_no"/>
            <result property="name" column="school_name"/>
            <result property="phoneNumber" column="school_phone_number"/>
        </collection>
        <collection property="careerList" ofType="com.apexsoft.ysprj.applicants.test.Career">
            <id property="applNo" column="appl_no"/>
            <result property="seqNo" column="work_seq_no"/>
            <result property="name" column="work_name"/>
            <result property="phoneNumber" column="work_phone_number"/>
        </collection>
    </resultMap>

    <select id="selectEntireApplicationByApplNo" resultMap="entireApplication" parameterType="String">
        <![CDATA[
        select a.appl_no as appl_no,
               a.user_name as name,
               a.phone_number as phone,
               a.address as addr,
               b.code as code,
               b.name as dept_name,
               b.phone_number as dept_phone_number,
               c.seq_no as school_seq_no,
               c.name as school_name,
               c.phone_number as school_phone_number,
               d.seq_no as work_seq_no,
               d.name as work_name,
               d.phone_number as work_phone_number
        from tmp_application a, tmp_department b, tmp_academy c, tmp_career d
        where a.dept_code = b.code
        and a.appl_no = c.appl_no
        and a.appl_no = d.appl_no
        and a.appl_no = #{applNo}
        ]]>
    </select>

    <resultMap id="entireApplicationNestedSelect" type="com.apexsoft.ysprj.applicants.test.EntireApplication">
        <id property="applNo" column="appl_no"/>
        <result property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="phoneNumber" column="user_phone_number"/>
        <result property="address" column="address"/>
        <result property="deptCode" column="dept_code"/>
        <association property="department" javaType="com.apexsoft.ysprj.applicants.test.Department">
            <id property="code" column="code"/>
            <result property="name" column="dept_name"/>
            <result property="phoneNumber" column="dept_phone_number"/>
        </association>
        <collection property="academyList" column="appl_no"
                    ofType="com.apexsoft.ysprj.applicants.test.Academy" select="selectAcademyListForEntireApplication"/>
        <collection property="careerList" column="appl_no"
                    ofType="com.apexsoft.ysprj.applicants.test.Career" select="selectCareerListForEntireApplication"/>
    </resultMap>

    <select id="selectEntireApplicationByApplNoNestedSelect" resultMap="entireApplicationNestedSelect" parameterType="String">
        <![CDATA[
        select a.appl_no as appl_no,
               a.user_name as name,
               a.phone_number as phone,
               a.address as addr,
               b.code as code,
               b.name as dept_name,
               b.phone_number as dept_phone_number
        from tmp_application a, tmp_department b, tmp_career d
        where a.dept_code = b.code
        and a.appl_no = #{applNo}
        ]]>
    </select>

    <select id="selectAcademyListForEntireApplication" resultType="com.apexsoft.ysprj.applicants.test.Academy" parameterType="String">
        <![CDATA[
        select appl_no, seq_no, name, phone_number
        from tmp_academy
        where appl_no = #{applno}
        ]]>
    </select>

    <select id="selectCareerListForEntireApplication" resultType="com.apexsoft.ysprj.applicants.test.Career" parameterType="String">
        <![CDATA[
        select appl_no, seq_no, name, phone_number
        from tmp_career
        where appl_no = #{applno}
        ]]>
    </select>

</mapper>